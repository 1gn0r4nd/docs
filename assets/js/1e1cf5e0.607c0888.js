"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1208],{58234:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return o},default:function(){return p},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return m}});var a=n(83117),i=(n(67294),n(3905)),r=n(90814);const s={id:"request",title:"Request an Attestation"},o=void 0,l={unversionedId:"develop/workshop/claimer/request",id:"develop/workshop/claimer/request",title:"Request an Attestation",description:"In this section, we'll create a Claim and a RequestForAttestation.",source:"@site/docs/develop/03_workshop/05_claimer/02_request.md",sourceDirName:"develop/03_workshop/05_claimer",slug:"/develop/workshop/claimer/request",permalink:"/docs/develop/workshop/claimer/request",draft:!1,editUrl:"https://github.com/KILTprotocol/docs/edit/master/docs/develop/03_workshop/05_claimer/02_request.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"request",title:"Request an Attestation"},sidebar:"workshop",previous:{title:"DID",permalink:"/docs/develop/workshop/claimer/did"},next:{title:"\ud83e\uddfe Attestation",permalink:"/docs/develop/workshop/attestation"}},c={},m=[{value:"Create Claim",id:"create-claim",level:2},{value:"Create Request",id:"create-request",level:2},{value:"Run",id:"run",level:2}],u={toc:m};function p(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"In this section, we'll create a ",(0,i.kt)("inlineCode",{parentName:"p"},"Claim")," and a ",(0,i.kt)("inlineCode",{parentName:"p"},"RequestForAttestation"),".\nBut a claim in itself has no value.\nTo become valid in the eyes of ",(0,i.kt)("span",{className:"label-role verifier"},"Verifiers"),", it needs to be attested by an entity they can trust: an ",(0,i.kt)("span",{className:"label-role attester"},"Attester"),"."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"}," KILT is an open system.\nAnyone/anything can make a claim about themselves and attest this claim.\nBut a claim only has value if the Verifier ",(0,i.kt)("em",{parentName:"p"},"trusts")," the Attester.")),(0,i.kt)("h2",{id:"create-claim"},"Create Claim"),(0,i.kt)("p",null,"We'll use provided ",(0,i.kt)("inlineCode",{parentName:"p"},"light DID"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"ctype")," and ",(0,i.kt)("span",{className:"label-role claimer"},"Claimer")," provided ",(0,i.kt)("inlineCode",{parentName:"p"},"content")," to generate the ",(0,i.kt)("inlineCode",{parentName:"p"},"Claim")," object.\nCreate a file ",(0,i.kt)("inlineCode",{parentName:"p"},"claimer/createClaim.ts")," and copy the code below."),(0,i.kt)(r.Z,{className:"language-ts",title:"claimer/createClaim.ts",mdxType:"CodeBlock"},"import * as Kilt from '@kiltprotocol/sdk-js'\n\n// create a Claim object from lightDid, ctype and given content\nexport function createClaim(\n  lightDid: Kilt.Did.LightDidDetails,\n  ctype: Kilt.CType,\n  content: Kilt.IClaim['contents']\n): Kilt.IClaim {\n  const claim = Kilt.Claim.fromCTypeAndClaimContents(\n    ctype,\n    content,\n    lightDid.uri\n  )\n\n  return claim\n}\n"),(0,i.kt)("p",null,"The magic happens in the ",(0,i.kt)("inlineCode",{parentName:"p"},"createRequest")," function.\nThere we create a request for attestation from a claim.\nAttestations can only be created for attributes that the ",(0,i.kt)("span",{className:"label-role claimer"},"Claimer")," wants to publish.\nTo ensure that the Claimer also approves of the attributes in the claim, they have to digitally sign the request for attestation.\nThe signature makes sure that the Attester doesn't change the attributes and the attestation is created for the agreed values."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"main")," function puts it all together.\nThere we load our light DID, create a claim and finally the request for attestation."),(0,i.kt)("h2",{id:"create-request"},"Create Request"),(0,i.kt)("p",null,"A claim is composed of attributes that we claim to be true about us.\nSince we want to receive an attestation for that claim, we build a ",(0,i.kt)("inlineCode",{parentName:"p"},"RequestForAttestation"),".\nThe request contains all necessary information, so that the ",(0,i.kt)("span",{className:"label-role attester"},"Attester")," can create an attestation for us.\nCreate a file ",(0,i.kt)("inlineCode",{parentName:"p"},"claimer/generateRequest.ts")," and copy the code below."),(0,i.kt)(r.Z,{className:"language-ts",title:"claimer/generateRequest.ts",mdxType:"CodeBlock"},"import { config as envConfig } from 'dotenv'\n\nimport * as Kilt from '@kiltprotocol/sdk-js'\n\nimport { createClaim } from './createClaim'\nimport { generateKeypairs } from './generateKeypairs'\nimport { getCtypeSchema } from '../attester/ctypeSchema'\n\n// create and return a RequestForAttestation from claim\nasync function requestFromClaim(\n  lightDid: Kilt.Did.LightDidDetails,\n  keystore: Kilt.Did.DemoKeystore,\n  claim: Kilt.IClaim\n): Promise<Kilt.IRequestForAttestation> {\n  const request = Kilt.RequestForAttestation.fromClaim(claim)\n  await request.signWithDidKey(\n    keystore,\n    lightDid,\n    lightDid.authenticationKey.id\n  )\n\n  return request\n}\n\nexport async function generateRequest(\n  claimAttributes: Kilt.IClaim['contents']\n): Promise<Kilt.IRequestForAttestation> {\n  // init\n  await Kilt.init({ address: process.env.WSS_ADDRESS })\n\n  const keystore = new Kilt.Did.DemoKeystore()\n  const keys = await generateKeypairs(keystore, process.env.CLAIMER_MNEMONIC)\n\n  // create the DID\n  const lightDid = Kilt.Did.LightDidDetails.fromDetails({\n    ...keys,\n    authenticationKey: {\n      publicKey: keys.authenticationKey.publicKey,\n      type: Kilt.VerificationKeyType.Sr25519\n    }\n  })\n\n  // create claim\n  const ctype = getCtypeSchema()\n  const claim = await createClaim(lightDid, ctype, claimAttributes)\n\n  // create request\n  console.log('claimer -> create request')\n  return await requestFromClaim(lightDid, keystore, claim)\n}\n\n// don't execute if this is imported by another file\nif (require.main === module) {\n  envConfig()\n  generateRequest({\n    age: 28,\n    name: 'Max Mustermann'\n  })\n    .catch((e) => {\n      console.log('Error while building request for attestation', e)\n      process.exit(1)\n    })\n    .then((request) => {\n      console.log(\n        '\u26a0\ufe0f  save this to ./claimer/_request.json for testing  \u26a0\ufe0f\\n\\n'\n      )\n      console.log(JSON.stringify(request, null, 2))\n      process.exit()\n    })\n}\n"),(0,i.kt)("p",null,"When ",(0,i.kt)("inlineCode",{parentName:"p"},"Attestations")," are given by ",(0,i.kt)("span",{className:"label-role attester"},"Attesters"),", they are written to chain which requires a deposit.\nEach new ",(0,i.kt)("inlineCode",{parentName:"p"},"RequestForAttestation")," is unique.\nWhile we're testing, we can store and reuse requests to avoid\nmultiple attestations.\nTo do this store the output into ",(0,i.kt)("inlineCode",{parentName:"p"},"./claimer/_request.json"),".\nYou can also share this\nrequest with others in the workshop to see how they get denied from fraudulent senders."),(0,i.kt)("h2",{id:"run"},"Run"),(0,i.kt)("p",null,"Run it from command line:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn ts-node claimer/generateRequest.ts\n")),(0,i.kt)("p",null,"OK, you've made a claim as a ",(0,i.kt)("span",{className:"label-role claimer"},"Claimer")," and created a request for attestation.\nLet's finish up our ",(0,i.kt)("span",{className:"label-role attester"},"Attester")," and get a credential!"))}p.isMDXComponent=!0}}]);