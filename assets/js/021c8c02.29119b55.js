"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2675],{19111:function(t,e,n){n.r(e),n.d(e,{assets:function(){return c},contentTitle:function(){return r},default:function(){return h},frontMatter:function(){return o},metadata:function(){return l},toc:function(){return u}});var a=n(83117),i=(n(67294),n(3905)),s=n(90814);const o={id:"attestation",title:"\ud83e\uddfe Attestation"},r=void 0,l={unversionedId:"develop/workshop/attestation",id:"develop/workshop/attestation",title:"\ud83e\uddfe Attestation",description:"In this section, your Attester will receive and process a RequestForAttestation where you'll",source:"@site/docs/develop/03_workshop/06_attestation.md",sourceDirName:"develop/03_workshop",slug:"/develop/workshop/attestation",permalink:"/docs/develop/workshop/attestation",draft:!1,editUrl:"https://github.com/KILTprotocol/docs/edit/master/docs/develop/03_workshop/06_attestation.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{id:"attestation",title:"\ud83e\uddfe Attestation"},sidebar:"workshop",previous:{title:"Request an Attestation",permalink:"/docs/develop/workshop/claimer/request"},next:{title:"\ud83e\udd1d Verification",permalink:"/docs/develop/workshop/verification"}},c={},u=[{value:"Attest a Claim",id:"attest-a-claim",level:2},{value:"Run",id:"run",level:2}],d={toc:u};function h(t){let{components:e,...n}=t;return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"In this section, your ",(0,i.kt)("span",{className:"label-role attester"},"Attester")," will receive and process a ",(0,i.kt)("inlineCode",{parentName:"p"},"RequestForAttestation")," where you'll"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Attest or deny it;"),(0,i.kt)("li",{parentName:"ul"},"Store the attestation on the chain (more specifically only its hash, we'll get to that);"),(0,i.kt)("li",{parentName:"ul"},"Build the ",(0,i.kt)("inlineCode",{parentName:"li"},"Attestation")," object which will be send back to the ",(0,i.kt)("span",{className:"label-role claimer"},"Claimer"),".")),(0,i.kt)("h2",{id:"attest-a-claim"},"Attest a Claim"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"attestClaim")," function first initialized all libraries, as always.\nAfter that we can load the account and DID of the ",(0,i.kt)("span",{className:"label-role attester"},"Attester"),".\nWhen everything is prepared, we can create an attestation using the request we received from the ",(0,i.kt)("span",{className:"label-role claimer"},"Claimer"),".\nThe attestation becomes valid once it is submitted to the chain."),(0,i.kt)(s.Z,{className:"language-ts",title:"attester/attestClaim.ts",mdxType:"CodeBlock"},"import { config as envConfig } from 'dotenv'\n\nimport * as Kilt from '@kiltprotocol/sdk-js'\n\nimport { generateKeypairs } from './generateKeypairs'\nimport { generateRequest } from '../claimer/generateRequest'\nimport { getAccount } from './generateAccount'\nimport { getFullDid } from './generateDid'\n\nexport async function attestClaim(\n  request: Kilt.IRequestForAttestation\n): Promise<Kilt.IAttestation> {\n  // Init\n  await Kilt.init({ address: process.env.WSS_ADDRESS })\n\n  // load account & DID\n  const mnemonic = process.env.ATTESTER_MNEMONIC as string\n  const attesterDid = process.env.ATTESTER_DID_URI as Kilt.DidUri\n  const account = await getAccount(mnemonic)\n  const keystore = new Kilt.Did.DemoKeystore()\n  await generateKeypairs(keystore, mnemonic)\n  const fullDid = await getFullDid(attesterDid)\n\n  // build the attestation object\n  const attestation = Kilt.Attestation.fromRequestAndDid(request, fullDid.uri)\n\n  // check the request content and deny based on your business logic.\n  // e.g., verify age with other credentials (birth certificate, passport, ...)\n\n  // form tx and authorized extrinsic\n  const tx = await attestation.getStoreTx()\n  const extrinsic = await fullDid.authorizeExtrinsic(\n    tx,\n    keystore,\n    account.address\n  )\n\n  // write to chain\n  console.log('Attester -> submit attestation...')\n  await Kilt.BlockchainUtils.signAndSubmitTx(extrinsic, account, {\n    resolveOn: Kilt.BlockchainUtils.IS_FINALIZED\n  })\n\n  return attestation\n}\n\nexport async function attestingFlow(): Promise<Kilt.ICredential> {\n  // first the claimer\n  const request = await generateRequest({\n    age: 27,\n    name: 'Mia Musterfrau'\n  })\n\n  // send the request to the attester \ud83d\udd4a\n\n  // the attester checks the attributes and issues an attestation\n  const attestation = await attestClaim(request)\n\n  // send the attestation back to the claimer \ud83d\udd4a\n\n  // build the credential and return it\n  const credential = Kilt.Credential.fromRequestAndAttestation(\n    request,\n    attestation\n  )\n\n  return credential\n}\n\n// don't execute if this is imported by another file\nif (require.main === module) {\n  envConfig()\n  attestingFlow()\n    .catch((e) => {\n      console.log('Error while going throw attesting workflow', e)\n      process.exit(1)\n    })\n    .then((c) => {\n      console.log('The claimer build their credential and now has to store it.')\n      console.log('\u26a0\ufe0f  add the following to your .env file. \u26a0\ufe0f')\n      console.log(`CLAIMER_CREDENTIAL='${JSON.stringify(c)}'`)\n      process.exit()\n    })\n}\n"),(0,i.kt)("p",null,"The function ",(0,i.kt)("inlineCode",{parentName:"p"},"attestingFlow")," shows the process from the beginning to the end.\nFirst the ",(0,i.kt)("span",{className:"label-role claimer"},"Claimer")," generates the request and sends it to the ",(0,i.kt)("span",{className:"label-role attester"},"Attester"),".\nAfter that the ",(0,i.kt)("span",{className:"label-role attester"},"Attester")," checks the attributes and either issues an attestation or denies the attestation because the attributes are invalid.\nOnce the attestation is written on the chain and sent back to the ",(0,i.kt)("span",{className:"label-role claimer"},"Claimer"),", they can build a credential from the request they sent and the attestation they received."),(0,i.kt)("h2",{id:"run"},"Run"),(0,i.kt)("p",null,"Run it from command line:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn ts-node attester/attestClaim.ts\n")),(0,i.kt)("p",null,"You can copy the ",(0,i.kt)("inlineCode",{parentName:"p"},"Credential")," object if you want to test with other ",(0,i.kt)("inlineCode",{parentName:"p"},"Verifiers")," in the workshop :-)"),(0,i.kt)("p",null,"Your job as an ",(0,i.kt)("span",{className:"label-role attester"},"Attester")," is done: you've successfully attested a claim, written the attestation hash onto the chain, and prepared the ",(0,i.kt)("inlineCode",{parentName:"p"},"Credential")," object for the ",(0,i.kt)("span",{className:"label-role claimer"},"Claimer"),"."),(0,i.kt)("p",null,"Let's move on to setup our ",(0,i.kt)("span",{className:"label-role verifier"},"Verifier"),"!"))}h.isMDXComponent=!0}}]);