"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[678],{46907:function(n,t,i){i.r(t),i.d(t,{contentTitle:function(){return r},default:function(){return p},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return d}});var o=i(83117),e=i(80102),c=(i(67294),i(3905)),a=i(31736),s=["components"],l={id:"account-link",title:"Link an Account to a KILT DID"},r=void 0,u={unversionedId:"develop/sdk/cookbook/account_linking/account-link",id:"develop/sdk/cookbook/account_linking/account-link",title:"Link an Account to a KILT DID",description:"An account can be linked to a DID in one of two ways:",source:"@site/docs/develop/01_sdk/02_cookbook/03_account_linking/01_link.md",sourceDirName:"develop/01_sdk/02_cookbook/03_account_linking",slug:"/develop/sdk/cookbook/account_linking/account-link",permalink:"/docs/develop/sdk/cookbook/account_linking/account-link",editUrl:"https://github.com/KILTprotocol/docs/edit/master/docs/develop/01_sdk/02_cookbook/03_account_linking/01_link.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"account-link",title:"Link an Account to a KILT DID"},sidebar:"sdk",previous:{title:"Release a web3name",permalink:"/docs/develop/sdk/cookbook/web3names/web3name-release"},next:{title:"Query the web3name of an Account",permalink:"/docs/develop/sdk/cookbook/account_linking/account-name"}},d=[],k={toc:d};function p(n){var t=n.components,i=(0,e.Z)(n,s);return(0,c.kt)("wrapper",(0,o.Z)({},k,i,{components:t,mdxType:"MDXLayout"}),(0,c.kt)("p",null,"An account can be linked to a DID in one of two ways:"),(0,c.kt)("ol",null,(0,c.kt)("li",{parentName:"ol"},"The account to be linked generates a signature over the payload ",(0,c.kt)("inlineCode",{parentName:"li"},"<Bytes>(SubmitterDid, BlockNumberExpiration)</Bytes>"),", which is the default encoding of the PolkadotJS extension:")),(0,c.kt)(a.Z,{className:"language-ts",mdxType:"CodeBlock"},"import type { KeyringPair } from '@polkadot/keyring/types'\n\nimport { u8aToHex } from '@polkadot/util'\n\nimport * as Kilt from '@kiltprotocol/sdk-js'\n\nexport async function linkAccountToDid(\n  keystore: Kilt.Did.DemoKeystore,\n  did: Kilt.Did.FullDidDetails,\n  submitterAccount: KeyringPair,\n  linkedAccount: KeyringPair,\n  resolveOn: Kilt.SubscriptionPromise.ResultEvaluator = Kilt.BlockchainUtils\n    .IS_FINALIZED\n): Promise<void> {\n  // The account to be linked has to sign a specifically-crafted payload to prove\n  // willingness to be linked to the DID.\n  const linkingAccountSignatureGeneration = async (\n    signaturePayload: string | Uint8Array\n  ) => u8aToHex(linkedAccount.sign(signaturePayload))\n\n  // Authorizing the extrinsic with the full DID and including a signature of the linked account\n  // results in the provided account being linked to the DID authorizing the operation.\n  const accountLinkingTx = await Kilt.Did.AccountLinks.authorizeLinkWithAccount(\n    linkedAccount.address,\n    did.identifier,\n    linkingAccountSignatureGeneration\n  ).then((tx) => did.authorizeExtrinsic(tx, keystore, submitterAccount.address))\n\n  await Kilt.BlockchainUtils.signAndSubmitTx(\n    accountLinkingTx,\n    submitterAccount,\n    {\n      resolveOn\n    }\n  )\n}\n"),(0,c.kt)("ol",{start:2},(0,c.kt)("li",{parentName:"ol"},"The account submitting the linking transaction is linked to the DID authorizing such transaction:")),(0,c.kt)(a.Z,{className:"language-ts",mdxType:"CodeBlock"},"import type { KeyringPair } from '@polkadot/keyring/types'\n\nimport * as Kilt from '@kiltprotocol/sdk-js'\n\nexport async function linkDidToAccount(\n  keystore: Kilt.Did.DemoKeystore,\n  did: Kilt.Did.FullDidDetails,\n  submitterAccount: KeyringPair,\n  resolveOn: Kilt.SubscriptionPromise.ResultEvaluator = Kilt.BlockchainUtils\n    .IS_FINALIZED\n): Promise<void> {\n  // Authorizing the extrinsic with the full DID and submitting it with the provided account\n  // results in the submitter's account being linked to the DID authorizing the operation.\n  const accountLinkingTx =\n    await Kilt.Did.AccountLinks.getAssociateSenderTx().then((tx) =>\n      did.authorizeExtrinsic(tx, keystore, submitterAccount.address)\n    )\n\n  await Kilt.BlockchainUtils.signAndSubmitTx(\n    accountLinkingTx,\n    submitterAccount,\n    {\n      resolveOn\n    }\n  )\n}\n"))}p.isMDXComponent=!0}}]);