"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9170],{82885:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return p},frontMatter:function(){return r},metadata:function(){return l},toc:function(){return d}});var i=n(83117),a=(n(67294),n(3905)),o=n(90814);const r={id:"did",title:"DID"},s=void 0,l={unversionedId:"develop/workshop/attester/did",id:"develop/workshop/attester/did",title:"DID",description:"Time to make a DID using the previously created account for the Attester.",source:"@site/docs/develop/03_workshop/04_attester/02_did.md",sourceDirName:"develop/03_workshop/04_attester",slug:"/develop/workshop/attester/did",permalink:"/docs/develop/workshop/attester/did",draft:!1,editUrl:"https://github.com/KILTprotocol/docs/edit/master/docs/develop/03_workshop/04_attester/02_did.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"did",title:"DID"},sidebar:"workshop",previous:{title:"Account",permalink:"/docs/develop/workshop/attester/account"},next:{title:"CType",permalink:"/docs/develop/workshop/attester/ctype"}},c={},d=[{value:"Account vs DID",id:"account-vs-did",level:2},{value:"Create a DID",id:"create-a-did",level:2},{value:"Execute",id:"execute",level:2}],u={toc:d};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Time to make a DID using the previously created account for the ",(0,a.kt)("span",{className:"label-role attester"},"Attester"),"."),(0,a.kt)("p",null,"A DID may represent any entity, may it be a person, an organization or a machine."),(0,a.kt)("p",null,"A KILT Decentralized Identifier (DID) is a string uniquely identifying each KILT user.\nYou can store information about your DID on the KILT chain.\nThis is useful for many different use cases.\nOne example would be messaging.\nYou would store a public encryption key and a service endpoint on-chain, that can both be queried using your DID.\nOther users can now encrypt messages using your public encryption key and send the message to your service endpoint."),(0,a.kt)("p",null,"There are light and full DIDs.\nTake a look at our ",(0,a.kt)("a",{parentName:"p",href:"/docs/develop/sdk/cookbook/dids/light-did-creation"},"DID documentation")," if you want to learn more about DIDs and the difference between their light and full versions."),(0,a.kt)("admonition",{title:"KILT DID",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"There are currently four different key types that a DID supports:"),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"An ",(0,a.kt)("em",{parentName:"li"},"authentication keypair"),", used to sign claims and create authenticated credential presentations"),(0,a.kt)("li",{parentName:"ul"},"A ",(0,a.kt)("em",{parentName:"li"},"key-agreement keypair"),", used to encrypt/decrypt messages"),(0,a.kt)("li",{parentName:"ul"},"An ",(0,a.kt)("em",{parentName:"li"},"assertion-method keypair"),", used to write CTypes and attestations on chain"),(0,a.kt)("li",{parentName:"ul"},"A ",(0,a.kt)("em",{parentName:"li"},"capability-delegation keypair"),", used to write Delegations on chain")),(0,a.kt)("p",{parentName:"admonition"},"Keys can be replaced over time, e.g., if a key is compromised.")),(0,a.kt)("h2",{id:"account-vs-did"},"Account vs DID"),(0,a.kt)("p",null,"A full DID needs to be registered on the blockchain.\nFor that, an account has to submit the DID creation transaction.\nThere is always an account that submits the transactions and pays for the fees and the DID that authorized the call.\nBecause the DID and the account are not connected, DIDs do not hold any coins."),(0,a.kt)("h2",{id:"create-a-did"},"Create a DID"),(0,a.kt)("admonition",{title:"Keystore",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"A keystore has multiple purposes:"),(0,a.kt)("p",{parentName:"admonition"},"The keystore ..."),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"stores private keys that belong to a DID"),(0,a.kt)("li",{parentName:"ul"},"creates new keys"),(0,a.kt)("li",{parentName:"ul"},"encrypts and decrypts arbitrary data"))),(0,a.kt)("p",null,"To create a DID we need a keystore.\nFor our ",(0,a.kt)("span",{className:"label-role attester"},"Attester")," we'll need all four types of keys.\nSince three of the key types are used for signatures, we can use the same key for these.\nWe'll use a demo keystore to generate them.\nCreate a file ",(0,a.kt)("inlineCode",{parentName:"p"},"attester/generateKeypairs.ts")," and copy the code below."),(0,a.kt)(o.Z,{className:"language-ts",title:"attester/generateKeypairs.ts",mdxType:"CodeBlock"},"import * as Kilt from '@kiltprotocol/sdk-js'\n\nexport async function generateKeypairs(\n  keystore: Kilt.Did.DemoKeystore,\n  mnemonic?: string\n): Promise<{\n  authentication: Kilt.NewDidVerificationKey\n  keyAgreement: Kilt.NewDidEncryptionKey\n  assertionMethod: Kilt.NewDidVerificationKey\n  capabilityDelegation: Kilt.NewDidVerificationKey\n}> {\n  // signing keypair\n  const signing = await keystore.generateKeypair({\n    alg: Kilt.Did.SigningAlgorithms.Sr25519,\n    seed: mnemonic\n  })\n\n  // encryption keypair\n  const encryption = await keystore.generateKeypair({\n    alg: Kilt.Did.EncryptionAlgorithms.NaclBox,\n    seed: mnemonic\n  })\n\n  // build the Attester keys object\n  const keys = {\n    authentication: {\n      publicKey: signing.publicKey,\n      type: Kilt.VerificationKeyType.Sr25519\n    },\n    keyAgreement: {\n      publicKey: encryption.publicKey,\n      type: Kilt.EncryptionKeyType.X25519\n    },\n    capabilityDelegation: {\n      publicKey: signing.publicKey,\n      type: Kilt.VerificationKeyType.Sr25519\n    },\n    assertionMethod: {\n      publicKey: signing.publicKey,\n      type: Kilt.VerificationKeyType.Sr25519\n    }\n  }\n\n  return keys\n}\n"),(0,a.kt)("p",null,"Once we have created all the necessary keys for a DID we can create the on-chain DID.\nTo create a DID we first initialize everything.\nAfter that, we load the account that we created in the ",(0,a.kt)("a",{parentName:"p",href:"/docs/develop/workshop/attester/account"},"last section"),".\nThe account will be used to pay for the DID registration.\nFinally, we create and submit the extrinsic (aka transaction) that will register our DID."),(0,a.kt)(o.Z,{className:"language-ts",title:"attester/generateDid.ts",mdxType:"CodeBlock"},"import { config as envConfig } from 'dotenv'\n\nimport * as Kilt from '@kiltprotocol/sdk-js'\n\nimport { generateKeypairs } from './generateKeypairs'\nimport { getAccount } from './generateAccount'\n\nexport async function createFullDid(): Promise<Kilt.Did.FullDidDetails> {\n  await Kilt.init({ address: process.env.WSS_ADDRESS })\n  const { api } = await Kilt.connect()\n  const mnemonic = process.env.ATTESTER_MNEMONIC as string\n\n  // Init keystore and load attester account\n  const account = await getAccount(mnemonic)\n  const keystore = new Kilt.Did.DemoKeystore()\n\n  // generate the keypairs\n  // we are using the same mnemonic as for the attester account, but we could also use a new secret\n  const keys = await generateKeypairs(keystore, mnemonic)\n\n  // get extrinsic that will create the DID on chain and DID-URI that can be used to resolve the DID Document\n  return new Kilt.Did.FullDidCreationBuilder(api, keys.authentication)\n    .addEncryptionKey(keys.keyAgreement)\n    .setAttestationKey(keys.assertionMethod)\n    .setDelegationKey(keys.capabilityDelegation)\n    .buildAndSubmit(keystore, account.address, async (creationTx) => {\n      await Kilt.BlockchainUtils.signAndSubmitTx(creationTx, account, {\n        resolveOn: Kilt.BlockchainUtils.IS_FINALIZED\n      })\n    })\n}\n\nexport async function getFullDid(\n  didUri: Kilt.DidUri\n): Promise<Kilt.Did.FullDidDetails> {\n  // make sure the did is already on chain\n  const onChain = await Kilt.Did.FullDidDetails.fromChainInfo(didUri)\n  if (!onChain) throw Error(`failed to find on chain did: ${didUri}`)\n  return onChain\n}\n\n// don't execute if this is imported by another file\nif (require.main === module) {\n  envConfig()\n  createFullDid()\n    .catch((e) => {\n      console.log('Error while creating attester DID', e)\n      process.exit(1)\n    })\n    .then((did) => {\n      console.log('\\nsave following to .env to continue\\n')\n      console.error(`ATTESTER_DID_URI=${did.uri}\\n`)\n      process.exit()\n    })\n}\n"),(0,a.kt)("h2",{id:"execute"},"Execute"),(0,a.kt)("p",null,"You can now execute the script with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"yarn ts-node ./attester/generateDid.ts\n")),(0,a.kt)("p",null,"Once you executed the script, the output should provide you with your ",(0,a.kt)("inlineCode",{parentName:"p"},"ATTESTER_DID_URI"),".\nYour output should look like this (but it won't be identical since the DIDs are constructed from your account):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ATTESTER_DID_URI=did:kilt:4rgeGJNgHNiZ9TngzQTwmSAYXxMJCUFVbMCcwqwGobwQvc9X\n")),(0,a.kt)("p",null,"Be sure to save it in your ",(0,a.kt)("inlineCode",{parentName:"p"},".env")," file, it should now look similar to this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-env",metastring:'title=".env"',title:'".env"'},'WSS_ADDRESS=wss://peregrine.kilt.io/parachain-public-ws\n\nATTESTER_MNEMONIC="warrior icon use cry...\nATTESTER_ADDRESS=4ohMvUHsyeDhMVZF...\nATTESTER_DID_URI=did:kilt:4ohMvUHsyeDhMVZF...\n')),(0,a.kt)("p",null,"Well done - You've successfully generated a full DID! Let's create a CType!"))}p.isMDXComponent=!0}}]);